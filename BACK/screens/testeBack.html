<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>testes</title>
  </head>
  <body>
    <h1>Testes do Back-end</h1>
    <h3>Form teste login</h3>

    <form action="#" method="post">
      <label for="email">Email:</label>
      <input type="email" id="email" name="email" required />
      <br />
      <label for="password">Senha:</label>
      <input type="password" id="password" name="password" required />
      <br />
      <button type="submit">Enviar</button>
    </form>
    <p>login: <strong id="resultadoLogin"></strong></p>
    <p>Usuário atual: <strong id="currentUser"></strong></p>

    <hr />

    <h3>cadastro usuario</h3>

    <form action="#" method="post" id="cadastroFuncionario">
      <label for="nome">Nome:</label>
      <input type="text" id="nomeFuncionario" name="nome" required />
      <br />
      <label for="email">Email:</label>
      <input type="email" id="emailFuncionario" name="email" required />
      <br />
      <label for="password">Senha:</label>
      <input
        type="text"
        id="passwordFuncionario"
        name="password"
        required
        minlength="8"
      />
      <br />
      <label for="cpf">CPF:</label>
      <input
        type="text"
        id="cpfFuncionario"
        name="cpf"
        required
        pattern="\d{11}"
        title="Digite um CPF válido com 11 dígitos"
      />
      <br />
      <select name="cargo" id="cargoFuncionario">
        <option value="garçom">Garçom</option>
        <option value="gerente">Gerente</option>
        <option value="administrador">Administrador</option>
      </select>
      <br />

      <button type="submit">Cadastrar</button>
    </form>
    <p id="cadastroResultado"></p>

    <script>
      (async () => {
        // teste de login
        let currentUser = null;

        const form = document.querySelector("form");
        const resultadoLogin = document.getElementById("resultadoLogin");
        const currentUserElement = document.getElementById("currentUser");

        form.addEventListener("submit", async (event) => {
          event.preventDefault();

          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;

          try {
            const response = await window.api.login.login(email, password);

            if (response) {
              resultadoLogin.textContent = `Login bem-sucedido! Token: ${response.nome}`;
              currentUser = await window.api.user.setCurrentUser(response); // Obtém os dados do usuário logado
              let User = await window.api.user.getCurrentUser(); // Obtém os dados do usuário logado
              currentUserElement.textContent = `usuario: ${User.nome} tipo: ${User.tipo}`; // Exibe o nome do usuário logado
            } else {
              resultadoLogin.textContent =
                "Falha no login. Verifique suas credenciais.";
            }
          } catch (error) {
            console.error("Erro ao fazer login:", error);
            resultadoLogin.textContent =
              "Ocorreu um erro ao tentar fazer login.";
          }
        });

        // teste de cadastro de funcionário
        const cadastroForm = document.getElementById("cadastroFuncionario");

        cadastroForm.addEventListener("submit", async (event) => {
          event.preventDefault();

          const nomeCadastro = document.getElementById("nomeFuncionario").value;
          const emailCadastro =
            document.getElementById("emailFuncionario").value;
          const passwordCadastro = document.getElementById(
            "passwordFuncionario",
          ).value;
          const cpfCadastro = document.getElementById("cpfFuncionario").value;
          const cargoCadastro =
            document.getElementById("cargoFuncionario").value;
          const cadastroResultado =
            document.getElementById("cadastroResultado");

          try {
            const responseCadastro =
              await window.api.funcionario.cadastrarFuncionario(
                nomeCadastro,
                cpfCadastro,
                emailCadastro,
                cargoCadastro,
                passwordCadastro,
              );
            console.log(responseCadastro);
            cadastroResultado.textContent =
              "Funcionário cadastrado com sucesso!";
          } catch (error) {
            console.error("Erro ao cadastrar funcionário:", error);
            cadastroResultado.textContent = "Erro ao cadastrar funcionário.";
          }
        });
      })();
    </script>
  </body>
</html>
